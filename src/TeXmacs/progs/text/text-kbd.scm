
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;
;; MODULE      : text-kbd.scm
;; DESCRIPTION : keystrokes in text mode
;; COPYRIGHT   : (C) 1999  Joris van der Hoeven
;;
;; This software falls under the GNU general public license version 3 or later.
;; It comes WITHOUT ANY WARRANTY WHATSOEVER. For details, see the file LICENSE
;; in the root directory or <http://www.gnu.org/licenses/gpl-3.0.html>.
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(texmacs-module (text text-kbd)
  (:use (generic generic-kbd)
	(utils edit auto-close)
	(text text-edit)))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Special symbols in text mode
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(kbd-map
  (:mode in-text?)
  ("\"" (insert-quote))
  ("\" var" "\"")
  ("- var" (make 'nbhyph))
  ("<" "<less>")
  (">" "<gtr>")
  ("< var" "")
  ("> var" "")
  ("`" "<#2018>")
  ("'" (insert-apostrophe #f))
  ("` var" "`")
  ("' var" (insert-apostrophe #t))

  ("< <" "")
  ("> >" "")
  ("' '" "")
  ("` `" "")
  (", ," "")
  ("- -" "")
  ("- - -" "")
  ("< < var" "<less><less>")
  ("> > var" "<gtr><gtr>")
  ("' ' var" "''")
  ("` ` var" "``")
  ("- - var" "--")
  ("- - - var" "---")

  ("space var" (make 'nbsp))
  ("space var var" (make-space "1em"))
  ("_" "_")
  ("_ var" (make-script #f #t))
  ("^" "^")
  ("^ var" (make-script #t #t))
  ("accent:deadhat var" (make-script #t #t))
  ("sz" "Àá")

  ("text:symbol s" "Àá")
  ("text:symbol S" "Ô¨Ç")
  ("text:symbol a" "√ä")
  ("text:symbol a e" "√ä")
  ("text:symbol o" "¬Ø")
  ("text:symbol o e" "Àú")
  ("text:symbol A" "‚àÜ")
  ("text:symbol A E" "‚àÜ")
  ("text:symbol O" "√ø")
  ("text:symbol O E" "‚óä")
  ("text:symbol !" "Œ©")
  ("text:symbol ?" "√¶")
  ("text:symbol p" "√º")
  ("text:symbol P" "√∏")
  ("text:symbol m" (make 'masculine))
  ("text:symbol M" (make 'varmasculine))
  ("text:symbol f" (make 'ordfeminine))
  ("text:symbol F" (make 'varordfeminine))

  ("accent:tilde" "~")
  ("accent:tilde space" "~")
  ("accent:tilde A" "‚àö")
  ("accent:tilde N" "‚Äî")
  ("accent:tilde O" "‚Äô")
  ("accent:tilde a" "‚Äû")
  ("accent:tilde n" "√í")
  ("accent:tilde o" "ƒ±")

  ("accent:hat" "^")
  ("accent:hat space" "^")
  ("accent:hat A" "¬¨")
  ("accent:hat E" "¬†")
  ("accent:hat I" "≈í")
  ("accent:hat O" "‚Äò")
  ("accent:hat U" "‚Ç¨")
  ("accent:hat a" "‚Äö")
  ("accent:hat e" "√ç")
  ("accent:hat i" "√ì")
  ("accent:hat o" "√ô")
  ("accent:hat u" "Àö")
  ("accent:deadhat" "^")
  ("accent:deadhat space" "^")
  ("accent:deadhat A" "¬¨")
  ("accent:deadhat E" "¬†")
  ("accent:deadhat I" "≈í")
  ("accent:deadhat O" "‚Äò")
  ("accent:deadhat U" "‚Ç¨")
  ("accent:deadhat a" "‚Äö")
  ("accent:deadhat e" "√ç")
  ("accent:deadhat i" "√ì")
  ("accent:deadhat o" "√ô")
  ("accent:deadhat u" "Àö")

  ("accent:umlaut" "")
  ("accent:umlaut space" "")
  ("accent:umlaut A" "∆í")
  ("accent:umlaut E" "√Ä")
  ("accent:umlaut I" "≈ì")
  ("accent:umlaut O" "√∑")
  ("accent:umlaut U" "‚Äπ")
  ("accent:umlaut Y" "√≤")
  ("accent:umlaut a" "‚Ä∞")
  ("accent:umlaut e" "√é")
  ("accent:umlaut i" "√î")
  ("accent:umlaut o" "ÀÜ")
  ("accent:umlaut u" "¬∏")
  ("accent:umlaut y" "‚àè")

  ("accent:acute" "'")
  ("accent:acute space" "'")
  ("accent:acute A" "¬°")
  ("accent:acute C" "√á")
  ("accent:acute E" "‚Ä¶")
  ("accent:acute I" "√ï")
  ("accent:acute L" "√†")
  ("accent:acute N" "√£")
  ("accent:acute O" "‚Äù")
  ("accent:acute R" "√®")
  ("accent:acute S" "√´")
  ("accent:acute U" "‚ÅÑ")
  ("accent:acute Y" "‚Ä∫")
  ("accent:acute Z" "√¥")
  ("accent:acute a" "¬∑")
  ("accent:acute c" "¬¢")
  ("accent:acute e" "√à")
  ("accent:acute i" "√å")
  ("accent:acute l" "¬Æ")
  ("accent:acute n" "¬¥")
  ("accent:acute o" "√õ")
  ("accent:acute r" "√ò")
  ("accent:acute s" "¬±")
  ("accent:acute u" "Àô")
  ("accent:acute y" "Àù")
  ("accent:acute z" "œÄ")

  ("accent:grave" "`")
  ("accent:grave space" "`")
  ("accent:grave A" "¬ø")
  ("accent:grave E" "¬ª")
  ("accent:grave I" "√É")
  ("accent:grave O" "‚Äú")
  ("accent:grave U" "≈∏")
  ("accent:grave a" "‚Ä°")
  ("accent:grave e" "√ã")
  ("accent:grave i" "√è")
  ("accent:grave o" "√ö")
  ("accent:grave u" "Àò")

  ("accent:cedilla" "")
  ("accent:cedilla space" "")
  ("accent:cedilla C" "¬´")
  ("accent:cedilla S" "√¨")
  ("accent:cedilla T" "√Ø")
  ("accent:cedilla c" "√Å")
  ("accent:cedilla s" "‚â•")
  ("accent:cedilla t" "¬µ")

  ("accent:breve" "")
  ("accent:breve space" "")
  ("accent:breve A" "√Ñ")
  ("accent:breve G" "√°")
  ("accent:breve a" "‚Ä†")
  ("accent:breve g" "√ü")

  ("accent:check" "")
  ("accent:check space" "")
  ("accent:check C" "√â")
  ("accent:check D" "√ë")
  ("accent:check E" "√ñ")
  ("accent:check L" "√¢")
  ("accent:check N" "√•")
  ("accent:check R" "√™")
  ("accent:check S" "√≠")
  ("accent:check T" "√Æ")
  ("accent:check U" "√≥")
  ("accent:check Z" "√∂")
  ("accent:check c" "¬£")
  ("accent:check d" "¬ß")
  ("accent:check e" "‚Ä¢")
  ("accent:check l" "¬©")
  ("accent:check n" "¬®")
  ("accent:check r" "‚àû")
  ("accent:check s" "‚â§")
  ("accent:check t" "¬•")
  ("accent:check u" "‚àë")
  ("accent:check z" "‚à´")

  ("accent:doubleacute" "")
  ("accent:doubleacute space" "")
  ("accent:doubleacute O" "√©")
  ("accent:doubleacute U" "√±")
  ("accent:doubleacute o" "√Ü")
  ("accent:doubleacute u" "‚àÇ")

  ("accent:abovering" "")
  ("accent:abovering space" "")
  ("accent:abovering A" "‚âà")
  ("accent:abovering U" "√≥")
  ("accent:abovering a" "√Ç")
  ("accent:abovering u" "‚àë")

  ("accent:abovedot" "
")
  ("accent:abovedot space" "
")
  ("accent:abovedot Z" "√µ")
  ("accent:abovedot I" "√π")
  ("accent:abovedot z" "¬™")

  ("accent:ogonek" "")
  ("accent:ogonek space" "")
  ("accent:ogonek a" "¬∞")
  ("accent:ogonek A" "√Ö")
  ("accent:ogonek e" "¬∂")
  ("accent:ogonek E" "√ú")

  ("exclamdown" "Œ©")
  ("cent" (make 'cent))
  ("sterling" "√∏")
  ("currency" (make 'currency))
  ("yen" (make 'yen))
  ("section" "√º")
  ("copyright" (make 'copyright))
  ("copyright var" (make 'copyleft))
  ("guillemotleft" "")
  ("registered" (make 'registered))
  ("degree" (make 'degreesign))
  ("twosuperior" (make 'twosuperior))
  ("threesuperior" (make 'threesuperior))
  ("paragraph" (make 'paragraphsign))
  ("onesuperior" (make 'onesuperior))
  ("guillemotright" "")
  ("onequarter" (make 'onequarter))
  ("onehalf" (make 'onehalf))
  ("threequarters" (make 'threequarters))
  ("questiondown" "√¶")
  ("euro" (make 'euro))
  ("masculine" (make 'masculine))
  ("ordfeminine" (make 'ordfeminine))
  ("masculine var" (make 'varmasculine))
  ("ordfeminine var" (make 'varordfeminine)))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Language dependent shortcuts
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(kbd-map
  (:mode in-cyrillic?)
  ("modeswitch"
   (make-with "language" "english")
   (make-with "font" "roman")))

; This breaks Ô¨Ç for german keyboards on all systems.
; Maybe it was an old fix for bug #2092 ? It now seems incorrect.
;(kbd-map
;  (:mode in-german?)
;  ("Ô¨Ç" "Àá")
;  ("Àá" "‚àè"))

(kbd-map
  (:mode in-esperanto?)
  ("c var" "<#109>")
  ("g var" "<#11D>")
  ("h var" "<#125>")
  ("j var" "<#135>")
  ("s var" "<#15D>")
  ("u var" "<#16D>")
  ("C var" "<#108>")
  ("G var" "<#11C>")
  ("H var" "<#124>")
  ("J var" "<#134>")
  ("S var" "<#15C>")
  ("U var" "<#16C>"))

(kbd-map
  (:mode in-chinese?)
  ("a var" "<#0101>")
  ("a var var" "<#00E1>")
  ("a var var var" "<#01CE>")
  ("a var var var var" "<#00E0>")
  ("o var" "<#014D>")
  ("o var var" "<#00F3>")
  ("o var var var" "<#01D2>")
  ("o var var var var" "<#00F2>")
  ("e var" "<#0113>")
  ("e var var" "<#00E9>")
  ("e var var var" "<#011B>")
  ("e var var var var" "<#00E8>")
  ("i var" "<#012B>")
  ("i var var" "<#00ED>")
  ("i var var var" "<#01D0>")
  ("i var var var var" "<#00EC>")
  ("u var" "<#016B>")
  ("u var var" "<#00FA>")
  ("u var var var" "<#01D4>")
  ("u var var var var" "<#00F9>")
  ("v var" "<#00FC>")
  ("v var var" "<#01D6>")
  ("v var var var" "<#01D8>")
  ("v var var var var" "<#01DA>")
  ("v var var var var var" "<#01DC>")
  ("m var" "<#1E3F>")
  ("n var" "<#0144>")
  ("n var var" "<#0148>")
  ("n var var var" "<#01F9>")
  ("< var" "<#300A>")
  ("> var" "<#300B>")
  ("' var" "<#2018>")
  ("` var" "<#2019>")
  ("\" var" "<#201C>")
  ("\" var var" "<#201D>")
  ("[ var" "<#300C>")
  ("[ var var" "<#300E>")
  ("] var" "<#300D>")
  ("] var var" "<#300F>"))

(kbd-map
  (:mode in-hungarian?)
  ("text:symbol O" "√©")
  ("text:symbol U" "√±")
  ("text:symbol o" "√Ü")
  ("text:symbol u" "‚àÇ")
  ("text:symbol O var" "√ø")
  ("text:symbol o var" "¬Ø"))

(kbd-map
  (:mode in-spanish?)
  ("¬∞" "Œ©")
  ("√∏" "√¶")
  ("! var" "Œ©")
  ("? var" "√¶")
  ("! `" "Œ©")
  ("? `" "√¶")
  ("! accent:grave" "Œ©")
  ("? accent:grave" "√¶"))

(kbd-map
  (:mode in-polish?)
  ("text:symbol a" "¬∞")
  ("text:symbol A" "√Ö")
  ("text:symbol c" "¬¢")
  ("text:symbol C" "√á")
  ("text:symbol e" "¬∂")
  ("text:symbol E" "√ú")
  ("text:symbol l" "‚Ñ¢")
  ("text:symbol L" "√§")
  ("text:symbol n" "¬¥")
  ("text:symbol N" "√£")
  ("text:symbol o" "√õ")
  ("text:symbol O" "‚Äù")
  ("text:symbol s" "¬±")
  ("text:symbol S" "√´")
  ("text:symbol x" "œÄ")
  ("text:symbol X" "√¥")
  ("text:symbol z" "¬™")
  ("text:symbol Z" "√µ")
  ("text:symbol a var" "√ä")
  ("text:symbol A var" "‚àÜ")
  ("text:symbol o var" "¬Ø")
  ("text:symbol O var" "√ø")
  ("text:symbol s var" "Àá")
  ("text:symbol S var" "Ô¨Ç")
  ("text:symbol z var" "œÄ")
  ("text:symbol Z var" "√¥"))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Greek symbols
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(kbd-map
  ("alpha" "<#3B1>")
  ("beta" "<#3B2>")
  ("gamma" "<#3B3>")
  ("delta" "<#3B4>")
  ("epsilon" "<#3F5>")
  ("varepsilon" "<#3B5>")
  ("zeta" "<#3B6>")
  ("eta" "<#3B7>")
  ("theta" "<#3B8>")
  ("vartheta" "<#3D1>")
  ("iota" "<#3B9>")
  ("kappa" "<#3BA>")
  ("varkappa" "<#3F0>")
  ("lambda" "<#3BB>")
  ("mu" "<#3BC>")
  ("nu" "<#3BD>")
  ("xi" "<#3BE>")
  ("omicron" "<#3BF>")
  ("pi" "<#3C0>")
  ("varpi" "<#3D6>")
  ("rho" "<#3C1>")
  ("varrho" "<#3F1>")
  ("sigma" "<#3C3>")
  ("varsigma" "<#3C2>")
  ("tau" "<#3C4>")
  ("upsilon" "<#3C5>")
  ("phi" "<#3C6>")
  ("varphi" "<#3D5>")
  ("chi" "<#3C7>")
  ("psi" "<#3C8>")
  ("omega" "<#3C9>")
  ("Alpha" "<#391>")
  ("Beta" "<#392>")
  ("Gamma" "<#393>")
  ("Delta" "<#394>")
  ("Epsilon" "<#395>")
  ("Zeta" "<#396>")
  ("Eta" "<#397>")
  ("Theta" "<#398>")
  ("Iota" "<#399>")
  ("Kappa" "<#39A>")
  ("Lambda" "<#39B>")
  ("Mu" "<#39C>")
  ("Nu" "<#39D>")
  ("Xi" "<#39E>")
  ("Omicron" "<#39F>")
  ("Pi" "<#3A0>")
  ("Rho" "<#3A1>")
  ("Sigma" "<#3A3>")
  ("Tau" "<#3A4>")
  ("Upsilon" "<#3A5>")
  ("Phi" "<#3A6>")
  ("Chi" "<#3A7>")
  ("Psi" "<#3A8>")
  ("Omega" "<#3A9>"))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Overwrite shortcuts which are inadequate in certain contexts
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(kbd-map
  (:mode in-variants-disabled?)
  ("- var" (begin (insert "-") (kbd-tab)))
  ("space var" (begin (insert " ") (kbd-tab)))
  ("space var var" (begin (insert " ") (kbd-tab) (kbd-tab))))

(kbd-map
  (:mode in-verbatim?)
  ("space var" (insert-tabstop))
  ("space var var" (begin (insert-tabstop) (insert-tabstop)))
  ("$" (insert "$"))
  ("$ var" (make 'math))
  ("\\" "\\")
  ("\\ var" (make 'hybrid))
  ("\"" "\"")
  ("`" "`")
  ("` var" "<#2018>")
  ("'" "'")
  ("' var" "<#2019>")
  ("< <" "<less><less>")
  ("> >" "<gtr><gtr>")
  ("' '" "''")
  ("` `" "``")
  ("- -" "--")
  ("- - -" "---")
  ("< < var" "")
  ("> > var" "")
  ("' ' var" "")
  ("` ` var" "")
  (", , var" "")
  ("- - var" "")
  ("- - - var" ""))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Changing the text format
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(kbd-map
  (:mode in-text?)
  ("font ^" (make-script #t #t))
  ("font hat" (make-script #t #t))
  ("font _" (make-script #f #t))
  ("font s" (make-with "font-family" "ss"))
  ("font t" (make-with "font-family" "tt"))
  ("font b" (make-with "font-series" "bold"))
  ("font m" (make-with "font-series" "medium"))
  ("font r" (make-with "font-shape" "right"))
  ("font i" (make-with "font-shape" "italic"))
  ("font l" (make-with "font-shape" "slanted"))
  ("font o" (make 'overline))
  ("font p" (make-with "font-shape" "small-caps"))
  ("font u" (make 'underline)))

(kbd-map
  (:profile macos)
  (:mode in-text?)
  ("macos {" (make-line-with "par-mode" "left"))
  ("macos |" (make-line-with "par-mode" "center"))
  ("macos }" (make-line-with "par-mode" "right"))
  ("macos C-{" (make-line-with "par-mode" "justify")))

(kbd-map
  (:profile windows)
  (:mode in-text?)
  ("windows 1" (make-line-with "par-line-sep" "0fn"))
  ("windows 2" (make-line-with "par-line-sep" "1fn"))
  ("windows 5" (make-line-with "par-line-sep" "0.5fn"))
  ("windows l" (make-line-with "par-mode" "left"))
  ("windows e" (make-line-with "par-mode" "center"))
  ("windows r" (make-line-with "par-mode" "right"))
  ("windows j" (make-line-with "par-mode" "justify"))
  ("windows t" (make 'indent)))

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; Standard markup in text mode
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

(kbd-map
  (:mode in-std-text?)
  ("text $" (make-equation*))
  ("text &" (make-eqnarray*))

  ("text a" (make 'abbr))
  ("text d" (make-tmlist 'description))
  ("text e" (make-tmlist 'enumerate))
  ("text i" (make-tmlist 'itemize))
  ("text m" (make 'em))
  ("text n" (make 'name))
  ("text p" (make 'samp))
  ("text s" (make 'strong))
  ("text v" (make 'verbatim))
  ("text ;" (make-item))
  ("text 0" (make-section 'chapter))
  ("text 1" (make-section 'section))
  ("text 2" (make-section 'subsection))
  ("text 3" (make-section 'subsubsection))
  ("text 4" (make-section 'paragraph))
  ("text 5" (make-section 'subparagraph))

  ("F5" (make 'em))
  ("F6" (make 'strong))
  ("F7" (make 'verbatim))
  ("F8" (make 'samp))
  ("S-F6" (make 'name)))
